(function(a){a.widget("pr.ui_revolving_sidebar",a.pr.widget_meta,{options:{items_container:".widget-area",item_class:"widget",content_class:"main",threshold:30,_dimensions:{}},_create:function(){this._super();if(a.is_device("desktop_narrow",">")){this._override();this._render();this._listen()}},_override:function(){var b=this},_render:function(){var c=this;c._index=0;c._enough=false;c.widgets=[];var b=c.element.find(c.options.items_container).find("."+c.options.item_class),d=a("aside").not(c.element).find(c.options.items_container).find("."+c.options.item_class);if(d.length>0){a.each(d,function(e,f){c.widgets.push(f)})}if(b.length>0){a.each(b,function(e,f){c.widgets.push(f)})}},_listen:function(){var b=this;a(window).on("load",function(c){while(!b._enough){b._append()}})},_append:function(){var b=this;var d=a(b.widgets[b._index]),c=a("."+b.options.content_class).outerHeight()-b.options.threshold;if(b.element.outerHeight()+a(d).outerHeight()<c){var e=a(d).clone(true);e.appendTo(b.element)}else{b._enough=true}b._index=b._index+1>=b.widgets.length?0:b._index+1}});a.widget("pr.widget_rating_stars",a.pr.widget_meta,{options:{rating:0},_create:function(){this._super();this._override();this._render();this._listen()},_override:function(){var b=this;if(typeof b.element.data("rating")!=="undefined"&&parseFloat(b.element.data("rating"))>0&&parseFloat(b.element.data("rating"))<=5){b.options.rating=parseFloat(b.element.data("rating"))}},_render:function(){var c=this;c.container=c.element;c.container.addClass(c.options._widget_class);c.icons=a('<div class="icons" />');c.back_icons=a('<div class="back row" />');c.front_icons=a('<div class="front row" />');for(i=1;i<=5;i++){c.back_icons.append('<div><i class="fa fa-star" /></div>');c.front_icons.append('<div><i class="fa fa-star" /></div>')}c.icons.append(c.back_icons).append(c.front_icons).appendTo(c.container);var e=c.back_icons.find(".fa").first().width(),f=c.options.rating;c.front_icons.children("div").hide();for(i=1;i<=f;i++){c.front_icons.children(":nth-child("+i+")").show()}if(f%1!=0){var d=parseInt(f)+1,b=f-parseInt(f);c.front_icons.find(":nth-child("+d+")").css({width:e*b+"px"}).show()}},_listen:function(){var b=this}});a.widget("pr.widget_rating",a.pr.widget_meta,{options:{ajax_action:null,value_class:"value",votes_class:"votes",_id:0,_current_rating:0,_is_static:false},_create:function(){this._super();this._override_options();this._create_ui();this._bind_events();this._update()},_override_options:function(){var b=this;if(typeof b.element.data("rating")!=="undefined"){b.options._current_rating=parseFloat(b.element.data("rating"))}if(typeof b.element.data("id")!=="undefined"){b.options._id=parseInt(b.element.data("id"))}},_create_ui:function(){var b=this;b.element.addClass(b.options._widget_class);b.value=b.element.find("."+b.options.value_class);b.votes=b.element.find("."+b.options.votes_class);b.icons=a('<div class="icons" />');b.background=a('<div class="back row" />');b.front=a('<div class="front row" />');for(i=1;i<=5;i++){b.background.append('<div><i class="fa fa-star" /></div>');b.front.append('<div><i class="fa fa-star" /></div>')}b.icons.append(b.background).append(b.front);b.icons.prependTo(b.element)},_bind_events:function(){},_update:function(){var c=this,f=c.options._current_rating,e=c.background.find(".fa").first().width();c.front.children("div").hide();for(i=1;i<=f;i++){c.front.children(":nth-child("+i+")").show()}if(f%1!=0){var d=parseInt(f)+1,b=f-parseInt(f);c.front.find(":nth-child("+d+")").css({width:e*b+"px"}).show()}},_vote:function(e){var b=this,c=b.action.children(":nth-child("+e+")");c.prevAll().andSelf().addClass("active");c.nextAll().removeClass("active");b.icons.addClass("voted");var d=a.ajax({url:b.options.ajax_url,method:"post",dataType:"json",data:{vote:e,id:b.options._id,nonce:b.options._nonce,pid:b.options._pid,action:b.options.ajax_action}});d.done(function(f){if("success" in f){if("value" in f&&"votes" in f){b.value.text(f.value);b.votes.text("("+f.votes+")");b._trigger("_vote_success",null,f)}}else{if("message" in f){a.status("info",f.message,null,true)}}b._trigger("_vote_done",null,f)});d.fail(function(){b._trigger("_vote_fail",null)});d.always(function(f){b._trigger("_voted",null,f)})}});a('[data-trigger="comment_reply"]').on("click",function(){var b=a(this),c=b.hasClass("active")?true:false,d=b.data("params"),e=b.closest(".comment");if(c){a.return_comment_form();a('[data-trigger="comment_reply"]').text("Ответить").removeClass("active")}else{a.borrow_comment_form(b.closest("div"),d.comment_id);a.scroll_to(e);a('[data-trigger="comment_reply"]').text("Ответить").removeClass("active");b.text("Отменить ответ").addClass("active")}});a("#comment-form").on("widget_form_submit_success",function(){a.return_comment_form();a('[data-trigger="comment_reply"]').text("Ответить").removeClass("active")});a('[data-scroll="#comment"]').on("click",function(){a.when(a.return_comment_form()).then(function(){a.scroll_to("#comment")});a('[data-trigger="comment_reply"]').text("Ответить").removeClass("active")});a.borrow_comment_form=function(d,g,e){var f={form_container:"#comment-form",container_parent:"#comment"};var k=a.extend({},f,e);var b=a(k.form_container),c=b.find("form"),h=a('<input type="hidden" name="comment_id" value="'+g+'" />'),j=a(k.container_parent);j.hide();c.find('[name="rating"]').closest(".form-element").hide();c.find('[name="comment_id"]').remove();c.append(h);b.appendTo(d)};a.return_comment_form=function(g){var f={form_container:"#comment-form",container_parent:"#comment"};var c=a.extend({},f,g);var b=a(c.form_container),e=b.find("form"),d=a(c.container_parent);d.show();e.find('[name="rating"]').closest(".form-element").show();e.find('[name="comment_id"]').remove();b.appendTo(d.find(".section-content"))};a.widget("pr.widget_comments",a.pr.widget_meta,{options:{_reply_class:"comment-reply",_form_id:"comment-form",_text:{reply:"Reply",cancel:"Cancel"}},_create:function(){this._super();this._override();this._render();this._listen()},_override:function(){var b=this;b.options._text=a.extend(b.options._text,b.options._translations)},_render:function(){var b=this;b.list=b.element.children("ul");b.form=a("#"+b.options._form_id);b.form_container=b.form.parent()},_listen:function(){var b=this;b.list.on("click","."+b.options._reply_class,function(d){d.preventDefault();var c=a(this),g=c.data("id"),f=c.closest(".comment");if(c.hasClass("active")){b._return_form();c.text(b.options._text.reply).removeClass("active")}else{b.list.find("."+b.options._reply_class).removeClass("active").text(b.options._text.reply);b._borrow_form(c.closest("div"),g);a.scroll_to(f);c.text(b.options._text.cancel).addClass("active")}});b.form.on("widget_form_submit_success",function(){b._return_form();b.list.find("."+b.options._reply_class).removeClass("active").text(b.options._text.reply)})},_borrow_form:function(d,c){var b=this;b.form.find('[name="parent"]').val(c);b.form.find('[name="rating"]').closest(".form-element").hide();b.form.appendTo(d)},_return_form:function(){var b=this;b.form.find('[name="parent"]').val("0");b.form.find('[name="rating"]').closest(".form-element").show();b.form.appendTo(b.form_container)}})})(jQuery);