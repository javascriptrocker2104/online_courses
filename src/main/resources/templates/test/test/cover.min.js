(function(a){a.widget("pr.widget_ibg",a.pr.widget_meta,{options:{_hue:210,_saturation:80,_lightness:40,_canvas_container_class:"ibg"},_create:function(){this._super();this._override();this._render();this._listen()},_override:function(){var b=this},_render:function(){var b=this;b.canvas=b._create_canvas();b.canvas.init()},_create_canvas:function(){var c=this;var e={CELL_SIZE:28,SURPLUS:4,NEIGHBORS:[{x:0,y:-1},{x:1,y:0},{x:0,y:1},{x:-1,y:0}],VELOCITY_RATE:0.05,DELTA_RATE:0.5,destroy:function(){c.element.find("."+c.options._canvas_container_class).remove()},init:function(){this.setParameters();this.createElements();this.reconstructMethods();this.bindEvent();this.render();this.forceOff()},setParameters:function(){this.$window=a(window);this.$container=c.element;this.$container.css("background","none");this.width=this.$container.outerWidth()+48;this.height=this.$container.outerHeight()+48;this.context=a("<canvas />").attr({width:this.width,height:this.height}).appendTo(this.$container).wrapAll('<div class="'+c.options._canvas_container_class+'" />').get(0).getContext("2d");this.cells=[];this.points=[];this.axis={x:Math.random()*this.width,y:Math.random()*this.height};this.velocityRate=this.VELOCITY_RATE*3},createElements:function(){var h=this.columnCount=Math.ceil(this.width/this.CELL_SIZE)+this.SURPLUS,g=this.rowCount=Math.ceil(this.height/this.CELL_SIZE)+this.SURPLUS;this.baseSize=this.CELL_SIZE*this.CELL_SIZE;this.columnOffset=(this.CELL_SIZE*h-this.width)/2;this.rowOffset=(this.CELL_SIZE*g-this.height)/2;for(var i=0;i<=g;i++){for(var f=0;f<=h;f++){this.points[this.getPointIndex(f,i)]=new b(f*this.CELL_SIZE,i*this.CELL_SIZE)}}for(var i=0;i<g;i++){for(var f=0;f<h;f++){this.cells[f+i*h]=new d(this,[this.points[this.getPointIndex(f,i)],this.points[this.getPointIndex(f+1,i)],this.points[this.getPointIndex(f+1,i+1)],this.points[this.getPointIndex(f,i+1)]])}}},getPointIndex:function(f,g){return f+g*(this.columnCount+1)},forceOn:function(g,f){if(g&&!this.axis){return}var h=this.$container.offset();this.axis={x:f.clientX-h.left+this.$window.scrollLeft(),y:f.clientY-h.top+this.$window.scrollTop()};this.$container.addClass("grabbing")},forceOff:function(){this.axis=null;this.$container.removeClass("grabbing")},reconstructMethods:function(){this.render=this.render.bind(this)},bindEvent:function(){this.$container.on("mouseover",this.forceOn.bind(this,false));this.$container.on("mousemove",this.forceOn.bind(this,true));this.$container.on("mouseup mouseleave",this.forceOff.bind(this))},propagateForce:function(){var f=this.CELL_SIZE,v=this.columnCount,p=this.rowCount,h=this.CELL_SIZE*this.CELL_SIZE*100;for(var n=0;n<=p;n++){for(var o=0;o<=v;o++){var t=this.points[this.getPointIndex(o,n)],s=1,z=o*f,w=n*f;for(var u=0;u<4;u++){var m=this.NEIGHBORS[u],k=o+m.x,j=n+m.y;if(k<0||k>v||j<0||j>p){continue}var B=this.points[this.getPointIndex(k,j)];z+=B.x-m.x*f;w+=B.y-m.y*f;s++}t.vx+=(z/s-t.x)*this.DELTA_RATE;t.vy+=(w/s-t.y)*this.DELTA_RATE;if(!this.axis){continue}var r=this.axis.x-t.x,q=this.axis.y-t.y,g=r*r+q*q,A=1-g/h;if(A<0){continue}t.vx+=r*A*this.velocityRate;t.vy+=q*A*this.velocityRate}}for(var u=0,l=this.points.length;u<l;u++){this.points[u].propagateForce()}this.velocityRate=this.VELOCITY_RATE},render:function(){requestAnimationFrame(this.render);this.context.clearRect(0,0,this.width,this.height);this.propagateForce();for(var f=0,g=this.cells.length;f<g;f++){this.cells[f].render(this.context)}}};var d=function(g,f){this.renderer=g;this.points=f};d.prototype={render:function(g){var h=(this.points[1].x-this.points[0].x)*(this.points[3].y-this.points[0].y)/this.renderer.baseSize;g.strokeStyle="hsl("+(c.options._hue+10)+", "+c.options._saturation+"%, "+(c.options._lightness+20)+"%)";g.fillStyle="hsl("+(c.options._hue-10*h)+", "+c.options._saturation+"%, "+(c.options._lightness+10*h)+"%)";g.beginPath();for(var f=0;f<4;f++){g[f==0?"moveTo":"lineTo"](this.points[f].x-this.renderer.columnOffset,this.points[f].y-this.renderer.rowOffset)}g.closePath();g.stroke();g.fill()}};var b=function(f,g){this.x=f;this.y=g;this.vx=0;this.vy=0};b.prototype={FRICTION:0.92,propagateForce:function(){this.x+=this.vx;this.y+=this.vy;this.vx*=this.FRICTION;this.vy*=this.FRICTION}};return e},_listen:function(){var b=this}})})(jQuery);jQuery(document).ready(function(a){a(".no-touch").find('[data-trigger="cover"]').widget_ibg()});